<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sección Películas</title>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://api.themoviedb.org">
    <link rel="preconnect" href="https://image.tmdb.org">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style> 
        :root {
            --background-primary: #121212;
            --background-secondary: #1E1E1E;
            --text-primary: #FFFFFF;
            --text-secondary: #dedede;
            --accent-primary: #E50914;
            --accent-secondary: #F5C518;
            --ui-element: #2C2C2C;
            --ui-hover: #454545;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--background-primary);
            color: var(--text-primary);
            text-align: center;   
            margin: 0;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            overflow-x: hidden;
        }

        header {
            background-color: var(--background-secondary);
            color: var(--text-primary);
            padding: 0.2rem 0;
            display: flex;
            position: sticky;
            top: 0;
            z-index: 1000;
            align-items: center;
            height: 40px;
        }
        .header-content {
            flex: 1;
            display: flex;
            justify-content: center;
            padding-right: 0px;
        }
        .logo {
            margin-left: 0.2rem;
        }
        h1 {
            display: flex;
            font-size: 1.5rem;
            margin: 0;
            padding: 0;
            flex-wrap: nowrap;            
            text-align: center;
            align-items: center;
        }
        .highlight {
            color: var(--accent-primary);
        }
        .secondary-highlight {
            color: var(--accent-secondary);
        }
        .back-link, .report {
            display: block;
            text-decoration: none;
            color: var(--text-secondary);
            padding: 10px;
            font-size: 1.2rem;
            transition: color 0.3s ease, background-color 0.3s ease;
        }
        .back-link:hover, .report:hover {
            color: var(--text-primary);
            background-color: var(--ui-hover);
        }
        .back-link i, .report i {
            margin-right: 10px;
        }
        .movie-info-container {
            display: flex;
            justify-content: center;
            margin-top: 0px;
            margin-bottom: 20px;
            position: sticky;
            top: 40px;
        }
        .movie-info {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            max-width: 1000px;
            margin: 0 auto;
            text-align: left;
            padding: 10px;
            background-color: var(--background-secondary);
            border-radius: 10px;
        }
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--ui-element);
            border-radius: 50%;
            border-top-color: var(--accent-primary);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (min-width: 1401px) {
        .streamfusion {
            font-weight: bold;
            background: linear-gradient(90deg, red 0%, red 50%, yellow 50%, yellow 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
            .container {
                display: flex;
                height: calc(100vh - 40px);
            }
            .player {
                display: flex;
                width: 60%;
                height: 100%;
                position: sticky;
                top: 40px;
                background-color: var(--background-primary);
                flex-direction: column;
            }
            .videoPlayer {
               height: calc(100% - 40px);
               padding: 1vw;
               position: relative;
            }
            .videoPlayer iframe {
                width: 100%;
                height: 100%;
                border: 2px solid var(--accent-secondary);
                border-radius: 10px;
            }
            .sidebar {
                width: 40%;
                padding: 5px;
                box-sizing: border-box;
                overflow-y: auto;
                height: 100%;
            }
            .sidebar .section {
                margin-bottom: 30px;
            }
            h3 {
                font-size: 1rem;
                margin-top: 1px;
                margin-bottom: 1px;
                color: var(--text-secondary);
            }
            .movie-details {
                flex: 0 0 70%;
                max-width: 70%;
                background-color: var(--background-secondary);
                padding-left: 10px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
                flex-direction: column;
                max-height: 100%;
            }
            .movie-details h2 {
                font-size: 1.5vw;
                line-height: 1;
                margin-bottom: 0px;
                margin-top: 0;
                color: var(--accent-secondary);
            }
            .movie-details p {
                font-size: 1.3vw;
                line-height: 0.9;
                margin-bottom: 8px;
                color: var(--text-secondary);
            }
            .related-movies {
                display: none;
            }
            .related-movies-2 .content-2 {
                display: flex;
                scroll-snap-type: x mandatory;
                gap: 5px;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            .related-movies-2 {
                display: flex;
                height: 40%;
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                margin: 0.5vw;
                border-radius: 10px;
            }
            .text-h3-1 {
                display: none;
            }
            .text-h3-0 {
                padding-top: 0.5vw;
            }
            .related-movies-2::-webkit-scrollbar {
                height: 8px;
            }
            .related-movies-2::-webkit-scrollbar-thumb {
                background-color: var(--ui-element);
                border-radius: 4px;
            }
            .related-movies-2::-webkit-scrollbar-track {
                background-color: var(--background-secondary);
            }
            .related-movies-2 .item {
                scroll-snap-align: start;
                flex: 0 0 auto;
                width: 200px;
                padding-right: 0.3em;
                text-align: center;
                position: relative;
                overflow: hidden;
            }
            .related-movies-2 .item img {
                width: 100%;
                max-width: 100%;
                height: auto;
                border-radius: 10px;
                transition: transform 0.3s ease;
            }
            .related-movies-2 .item:hover img {
                transform: scale(1.05);
            }
            .related-movies-2 .item-title {
                margin-top: 5px;
                font-size: 14px;
                text-align: center;
                color: var(--text-primary);
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background-color: rgba(0, 0, 0, 0.7);
                padding: 5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                border-bottom-left-radius: 10px;
                border-bottom-right-radius: 10px;
            }
            .related-movies-2 a {
                text-decoration: none;
                color: inherit;
            }
            .movie-poster { 
                flex: 0 0 30%;
                max-width: 30%;
            }
            #moviePoster {
                max-width: 100%;
                height: auto;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
                border-radius: 10px;
            }
            .movie-overview {
                background-color: var(--ui-element);
                padding: 15px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
                max-width: 1000px;
                margin: 15px auto;
                text-align: left;
                font-size: 1.3em;
                color: var(--text-secondary);
            }
            html, body {
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
        }
 
        @media (min-width: 600px) and (max-width: 1400px) {
        .streamfusion {
            font-weight: bold;
            background: linear-gradient(90deg, red 0%, red 50%, yellow 50%, yellow 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
            .container {
                display: flex;
                height: calc(100vh - 40px);
            }
            .player {
                display: flex;
                width: 60%;
                height: 100%;
                position: sticky;
                top: 40px;
                background-color: var(--background-primary);
                flex-direction: column;
            }
            .videoPlayer {
               height: calc(100% - 40px);
               padding: 1vw;
            }
            .videoPlayer iframe {
                width: 100%;
                height: 100%;
                border: 2px solid var(--accent-secondary);
                border-radius: 10px;
            }
            .sidebar {
                width: 40%;
                padding: 5px;
                box-sizing: border-box;
                overflow-y: auto;
                height: 100%;
            }
            .sidebar .section {
                margin-bottom: 30px;
            }
            h3 {
                font-size: 1rem;
                margin-top: 1px;
                margin-bottom: 1px;
                color: var(--text-secondary);
            }
            .movie-details {
                flex: 0 0 70%;
                max-width: 70%;
                background-color: var(--background-secondary);
                padding-left: 10px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
                flex-direction: column;
                max-height: 100%;
            }
            .movie-details h2 {
                font-size: 1.5vw;
                line-height: 1;
                margin-bottom: 0px;
                margin-top: 0;
                color: var(--accent-secondary);
            }
            .movie-details p {
                font-size: 1.3vw;
                line-height: 0.9;
                margin-bottom: 8px;
                color: var(--text-secondary);
            }
            .related-movies {
                display: none;
            }
            .related-movies-2 .content-2 {
                display: flex;
                scroll-snap-type: x mandatory;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            .related-movies-2 {
                display: flex;
                height: 40%;
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                margin: 0.5vw;
                border-radius: 10px;
            }
            .text-h3-1 {
                display: none;
            }
            .text-h3-0 {
                padding-top: 0.5vw;
            }
            .related-movies-2::-webkit-scrollbar {
                height: 8px;
            }
            .related-movies-2::-webkit-scrollbar-thumb {
                background-color: var(--ui-element);
                border-radius: 4px;
            }
            .related-movies-2::-webkit-scrollbar-track {
                background-color: var(--background-secondary);
            }
            .related-movies-2 .item {
                scroll-snap-align: start;
                flex: 0 0 auto;
                width: 120px;
                padding-right: 0.3em;
                text-align: center;
                position: relative;
                overflow: hidden;
            }
            .related-movies-2 .item img {
                width: 100%;
                max-width: 100%;
                height: auto;
                border-radius: 10px;
                transition: transform 0.3s ease;
            }
            .related-movies-2 .item:hover img {
                transform: scale(1.05);
            }
            .related-movies-2 .item-title {
                margin-top: 5px;
                font-size: 14px;
                text-align: center;
                color: var(--text-primary);
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background-color: rgba(0, 0, 0, 0.7);
                padding: 5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                border-bottom-left-radius: 10px;
                border-bottom-right-radius: 10px;
            }
            .related-movies-2 a {
                text-decoration: none;
                color: inherit;
            }
            .movie-poster { 
                flex: 0 0 30%;
                max-width: 30%;
            }
            #moviePoster {
                max-width: 100%;
                height: auto;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
                border-radius: 10px;
            }
            .movie-overview {
                background-color: var(--ui-element);
                padding: 15px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
                max-width: 1000px;
                margin: 15px auto;
                text-align: left;
                font-size: 1.3em;
                color: var(--text-secondary);
            }
            html, body {
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
          .item-rating {
              position: absolute;
              top: 8px;
              left: 8px;
              background: rgba(0, 0, 0, 0.7);
              color: #FFD700;
              font-size: 14px;
              font-weight: bold;
              padding: 4px 8px;
              border-radius: 5px;
          }
        }

        @media (max-width: 599px) {
        .streamfusion {
            font-weight: bold;
            background: linear-gradient(90deg, red 0%, red 50%, yellow 50%, yellow 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
            .player {
                height: 230px;
                position: sticky;
                top: 40px;
                background-color: var(--background-primary);
                z-index: 1;
            }
            .videoPlayer {
                height: 100%;
                background: var(--background-primary);
                position: relative;
            }
            .videoPlayer iframe {
                width: 100%;
                height: 100%;
                border-bottom: 2px solid var(--accent-secondary);
                border-bottom-left-radius: 10px;
                border-bottom-right-radius: 10px;
            }
            .content {
                padding: 5px;
            }
            .movie-details {
                flex: 0 0 70%;
                max-width: 70%;
                background-color: var(--background-secondary);
                padding-left: 10px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
                flex-direction: column;
            }
            .movie-details h2 {
                font-size: 4vw;
                line-height: 1.4;
                margin-bottom: 8px;
                margin-top: 0;
                color: var(--accent-secondary);
            }
            .movie-details p {
                font-size: 3vw;
                line-height: 1.1;
                margin-bottom: 8px;
                color: var(--text-secondary);
            }
            .related-movies .content{
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
                margin-top: 5px;
            }
            .related-movies-2 .content-2 {
                display: none;
            }
            .text-h3-0 {
                display: none;
            }
            .text-h3-1 {
                padding-top: 0.5vw;
            }
      h3 {
        font-size: 1rem;
        margin-top: 1px;
        margin-bottom: 1px;
        color: var(--text-secondary);
      }
            .related-movies .item {                        
                text-align: center;
                position: relative;
                overflow: hidden;
            }
            .related-movies .item img {
                width: 100%;
                max-width: 100%;
                height: auto;
                border-radius: 10px;
                transition: transform 0.3s ease;
            }
            .related-movies .item:hover img {
                transform: scale(1.05);
            }
            .related-movies .item-title {
                margin-top: 5px;
                font-size: 14px;
                text-align: center;
                color: var(--text-primary);
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background-color: rgba(0, 0, 0, 0.7);
                padding: 5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                border-bottom-left-radius: 10px;
                border-bottom-right-radius: 10px;
            }
            .related-movies a {
                text-decoration: none;
                color: inherit;
            }
            .movie-poster {
                flex: 0 0 30%;
                max-width: 30%;
            }
            #moviePoster {
                max-width: 100%;
                height: auto;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
                border-radius: 10px;
            }
            .movie-overview {
                background-color: var(--ui-element);
                padding: 10px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
                max-width: 1000px;
                margin: 10px auto;
                text-align: left;
                color: var(--text-secondary);
            }
        }
      
        .item-rating {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: #FFD700;
            font-size: 14px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 5px;
        }

        .reload-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            z-index: 10;
        }

        .reload-button:hover {
            background-color: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        .reload-button:active {
            transform: scale(0.95);
        }

        .reload-button i {
            transition: transform 0.5s;
        }

        .reload-button.loading i {
            animation: spin 1s linear infinite;
        }

        .page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(18, 18, 18, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .page-loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .fallback-poster {
            background-color: var(--ui-element);
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-secondary);
            font-size: 14px;
            border-radius: 10px;
        }
 
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Estilos para el sistema de licencia */
        .license-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .license-content {
            background-color: #222;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }

        .license-title {
            color: #e50914;
            margin-top: 0;
        }

        .license-description {
            color: #dedede;
            margin-bottom: 20px;
        }

        .license-input-group {
            margin-bottom: 15px;
        }

        .license-label {
            display: block;
            color: #fff;
            margin-bottom: 5px;
        }

        .license-input {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: none;
            text-align: center;
            background-color: #333;
            color: white;
        }

        .license-button {
            background-color: #e50914;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .license-message {
            margin-top: 15px;
            color: #ff6b6b;
            display: none;
        }

        .license-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }

        .license-valid {
            background-color: #16a34a;
            color: white;
        }

        .license-invalid {
            background-color: #e11d48;
            color: white;
            animation: pulse 2s infinite;
        }

        .license-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .license-toast-success {
            background-color: #16a34a;
        }

        .license-toast-error {
            background-color: #e11d48;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
      <script>
        // Sistema de licencia
        const licenseSystem = {
            isActivated: false,
            // IMPORTANTE: Aquí debes colocar la licencia que generes para este cliente
            // Esta licencia estará incluida en el código que distribuyas
            defaultLicense: "SF-ABC123-TV", // Reemplaza esto con una licencia real que generes
            licenseKey: "",
            
            // IMPORTANTE: Este es el texto exacto que debe tener el H1 para que el código funcione
            // Debes personalizar este valor para cada cliente
            expectedH1Text: 'StreamFusion',
            
            // IMPORTANTE: Este es el valor exacto que debe tener la API key para que el código funcione
            expectedApiKey: '32e5e53999e380a0291d66fb304153fe',
            
            titleObserver: null,
            titleCheckInterval: null,
            apiKeyCheckInterval: null,
            originalBodyContent: null,
            recoveryInterval: null,

            // Inicializar el sistema de licencia
            init: function() {
                console.log("Inicializando sistema de licencia...");
                
                // Obtener el título actual
                const titleElement = document.querySelector("h1");
                if (!titleElement) {
                    console.error("No se encontró el elemento h1");
                    this.showToast("Error crítico: No se encontró el elemento h1", true);
                    return;
                }
                
                const currentH1Text = titleElement.textContent.trim();
                console.log("H1 actual:", currentH1Text);
                console.log("H1 esperado:", this.expectedH1Text);
                
                // Verificar si el H1 coincide con el esperado
                const h1IsValid = currentH1Text === this.expectedH1Text;
                
                // Verificar que la API key coincida con la esperada
                const currentApiKey = this.getCurrentApiKey();
                const apiKeyIsValid = !currentApiKey || currentApiKey === this.expectedApiKey;
                
                // Si ambos valores son válidos, activar automáticamente sin mostrar diálogo
                if (h1IsValid && apiKeyIsValid) {
                    console.log("H1 y API key válidos, activando automáticamente");
                    
                    // Comprobar si ya hay una licencia almacenada
                    const storedLicense = localStorage.getItem("streamfusion_license");
                    
                    // Usar la licencia almacenada o la predeterminada
                    this.licenseKey = storedLicense || this.defaultLicense;
                    
                    // Guardar en localStorage si no existe
                    if (!storedLicense) {
                        localStorage.setItem("streamfusion_license", this.licenseKey);
                    }
                    
                    // Marcar como activado
                    localStorage.setItem("streamfusion_activated", "true");
                    this.isActivated = true;
                    
                    // Iniciar monitoreo del título y API key
                    this.startTitleMonitoring();
                    this.startApiKeyMonitoring();
                    
                    // Mostrar indicador de licencia
                    this.showLicenseStatus(true);
                    
                    // Inicializar la aplicación
                    initPage();
                } else {
                    // Si alguno de los valores no es válido, mostrar mensaje de error y bloquear
                    if (!h1IsValid) {
                        console.log("El H1 ha sido modificado, no coincide con el esperado");
                        this.showToast("Error: Licencia inválida", true);
                        this.deactivateLicense("El título ha sido modificado. Licencia invalidada.");
                    } else if (!apiKeyIsValid) {
                        console.log("La API key no coincide con la esperada");
                        this.showToast("Error: API key inválida", true);
                        this.deactivateLicense("Licencia invalidada.");
                    }
                }
                
                // Configurar atajo de teclado para generación de licencia (solo para el desarrollador)
                this.setupKeyboardShortcut();
            },
            
            // Iniciar monitoreo de la API key
            startApiKeyMonitoring: function() {
                console.log("Iniciando monitoreo de la API key");
                
                // Detener intervalo existente si hay uno
                if (this.apiKeyCheckInterval) {
                    clearInterval(this.apiKeyCheckInterval);
                }
                
                // Configurar verificación periódica de la API key
                this.apiKeyCheckInterval = setInterval(() => {
                    // Obtener la API key actual del código
                    const currentApiKey = this.getCurrentApiKey();
                    
                    if (currentApiKey && currentApiKey !== this.expectedApiKey) {
                        console.log("La API key ha sido modificada. Actual:", currentApiKey, "Esperada:", this.expectedApiKey);
                        clearInterval(this.apiKeyCheckInterval);
                        this.deactivateLicense("Licencia invalidada.");
                    }
                }, 5000); // Verificar cada 5 segundos
            },
            
            // Método auxiliar para obtener la API key actual del código
            getCurrentApiKey: function() {
                // Buscar la API key en el código fuente de la página
                const scripts = document.querySelectorAll('script');
                let currentApiKey = null;
                
                for (const script of scripts) {
                    if (script.textContent.includes('const apiKey =')) {
                        // Extraer la API key usando regex
                        const match = script.textContent.match(/const apiKey = ['"]([^'"]+)['"]/);
                        if (match && match[1]) {
                            currentApiKey = match[1];
                            break;
                        }
                    }
                }
                
                return currentApiKey;
            },
            
            // Generar una licencia
            generateLicense: function(customerName) {
                // Generar parte aleatoria de 6 caracteres
                const randomPart = Math.random().toString(36).substring(2, 8).toUpperCase();
                // Obtener primeras 3 letras del nombre del cliente
                const namePart = customerName.substring(0, 3).toUpperCase();
                // Formato: SF-XXXXXX-YYY
                return `SF-${randomPart}-${namePart}`;
            },
            
            // Validar una licencia
            validateLicense: function(license) {
                // Validación básica - comprobar formato
                const licenseRegex = /^SF-[A-Z0-9]{6}-[A-Z]{3}$/;
                return licenseRegex.test(license);
            },
            
            // Iniciar monitoreo del título
            startTitleMonitoring: function() {
                const titleElement = document.querySelector("h1");
                if (!titleElement) {
                    console.error("No se encontró el elemento h1 para monitorear");
                    return;
                }
                
                console.log("Iniciando monitoreo del título");
                
                // Desconectar observador existente si hay uno
                if (this.titleObserver) {
                    this.titleObserver.disconnect();
                }
                
                // Detener intervalo existente si hay uno
                if (this.titleCheckInterval) {
                    clearInterval(this.titleCheckInterval);
                }
                
                // Crear un nuevo MutationObserver
                this.titleObserver = new MutationObserver((mutations) => {
                    const currentH1Text = titleElement.textContent.trim();
                    
                    console.log("Cambio detectado en título. Actual:", currentH1Text, "Esperado:", this.expectedH1Text);
                    
                    // Si el título ha cambiado, desactivar la licencia
                    if (currentH1Text !== this.expectedH1Text) {
                        console.log("Título modificado, desactivando licencia");
                        this.deactivateLicense("El título ha sido modificado. Licencia invalidada.");
                    }
                });
                
                // Iniciar observación del elemento título
                this.titleObserver.observe(titleElement, { 
                    childList: true,      // Observar cambios en nodos hijos
                    characterData: true,  // Observar cambios en datos de texto
                    subtree: true,        // Observar todos los descendientes
                    attributes: true      // Observar cambios de atributos
                });
                
                // Verificación periódica adicional como respaldo
                this.titleCheckInterval = setInterval(() => {
                    const currentH1Text = titleElement.textContent.trim();
                    
                    if (currentH1Text !== this.expectedH1Text) {
                        console.log("Cambio de título detectado por verificación periódica");
                        clearInterval(this.titleCheckInterval);
                        this.deactivateLicense("El título ha sido modificado. Licencia invalidada.");
                    }
                }, 5000); // Verificar cada 5 segundos
            },
            
            // Desactivar temporalmente la licencia
            deactivateLicense: function(reason) {
                console.log("Desactivando temporalmente:", reason);
                
                // No eliminar la activación de localStorage para permitir recuperación
                this.isActivated = false;
                
                // Detener monitoreo temporalmente pero no eliminar los observadores
                if (this.titleObserver) {
                    this.titleObserver.disconnect();
                }
                
                if (this.titleCheckInterval) {
                    clearInterval(this.titleCheckInterval);
                }
                
                if (this.apiKeyCheckInterval) {
                    clearInterval(this.apiKeyCheckInterval);
                }
                
                // Guardar el contenido original del body si aún no se ha guardado
                if (!this.originalBodyContent) {
                    this.originalBodyContent = document.body.innerHTML;
                }
                
                // Mostrar mensaje de error
                document.body.innerHTML = '<div style="text-align: center; padding: 50px; font-family: sans-serif; background-color: #0e0e0e; color: white; height: 100vh;"><h1>ACCESO DENEGADO</h1><p>Esta licencia ya ha sido usada. Por favor, contacte al proveedor y obtenga un licencia válida.</p><p>Visita: <a href="https://streamfusion.top/" style="color: #e50914;">https://streamfusion.top/</a></p></div>';
                
                this.showToast(reason, true);
                
                // Mostrar indicador de licencia inválida
                this.showLicenseStatus(false);
                
                // Iniciar verificación periódica para comprobar si los valores han sido restaurados
                this.startRecoveryCheck();
            },

            // Añadir una nueva función para verificar periódicamente si los valores han sido restaurados
            startRecoveryCheck: function() {
                console.log("Iniciando verificación de recuperación");
                
                // Detener verificación existente si hay una
                if (this.recoveryInterval) {
                    clearInterval(this.recoveryInterval);
                }
                
                // Iniciar verificación periódica
                this.recoveryInterval = setInterval(() => {
                    // Verificar si el h1 ha sido restaurado
                    const titleElement = document.querySelector("h1");
                    let h1Restored = false;
                    
                    if (titleElement) {
                        const currentH1Text = titleElement.textContent.trim();
                        h1Restored = currentH1Text === this.expectedH1Text;
                        console.log("Verificando h1:", currentH1Text, "Esperado:", this.expectedH1Text, "Restaurado:", h1Restored);
                    }
                    
                    // Verificar si la API key ha sido restaurada
                    const currentApiKey = this.getCurrentApiKey();
                    let apiKeyRestored = false;
                    
                    if (currentApiKey) {
                        apiKeyRestored = currentApiKey === this.expectedApiKey;
                        console.log("Verificando API key:", currentApiKey, "Esperada:", this.expectedApiKey, "Restaurada:", apiKeyRestored);
                    }
                    
                    // Si ambos valores han sido restaurados, recuperar la aplicación
                    if (h1Restored && (apiKeyRestored || !currentApiKey)) {
                        console.log("Valores restaurados, recuperando aplicación");
                        this.recoverApplication();
                    }
                }, 3000); // Verificar cada 3 segundos
            },

            // Añadir una nueva función para recuperar la aplicación
            recoverApplication: function() {
                console.log("Recuperando aplicación");
                
                // Detener verificación de recuperación
                if (this.recoveryInterval) {
                    clearInterval(this.recoveryInterval);
                    this.recoveryInterval = null;
                }
                
                // Restaurar el contenido original del body
                if (this.originalBodyContent) {
                    document.body.innerHTML = this.originalBodyContent;
                    this.originalBodyContent = null;
                }
                
                // Reactivar la licencia
                this.isActivated = true;
                
                // Si no hay una licencia almacenada, usar la predeterminada
                if (!localStorage.getItem("streamfusion_license")) {
                    localStorage.setItem("streamfusion_license", this.defaultLicense);
                    this.licenseKey = this.defaultLicense;
                } else {
                    this.licenseKey = localStorage.getItem("streamfusion_license");
                }
                
                // Asegurarse de que la activación esté marcada como verdadera
                localStorage.setItem("streamfusion_activated", "true");
                
                // Reiniciar monitoreo
                this.startTitleMonitoring();
                this.startApiKeyMonitoring();
                
                // Mostrar indicador de licencia válida
                this.showLicenseStatus(true);
                
                // Mostrar mensaje de recuperación
                this.showToast("Aplicación recuperada correctamente");
                
                // Reinicializar la aplicación directamente sin mostrar el diálogo de activación
                initPage();
            },
            
            // Mostrar diálogo de activación
            showActivationDialog: function() {
                const dialog = document.createElement("div");
                dialog.id = "license-dialog";
                dialog.className = "license-dialog";
                
                dialog.innerHTML = `
                    <div class="license-content">
                        <h2 class="license-title">Activar StreamFusion</h2>
                        <p class="license-description">Ingrese su clave de licencia para continuar</p>
                        <div class="license-input-group">
                            <label for="licenseKey" class="license-label">Clave de Licencia</label>
                            <input type="text" id="licenseKey" class="license-input" value="" placeholder="SF-XXXX-XXXX">
                        </div>
                        <div class="license-button-group">
                            <button id="activateButton" class="license-button">Activar</button>
                        </div>
                        <p id="license-message" class="license-message"></p>
                    </div>
                `;
                
                document.body.appendChild(dialog);
                
                const licenseInput = document.getElementById("licenseKey");
                const activateButton = document.getElementById("activateButton");
                const licenseMessage = document.getElementById("license-message");
                
                // Si hay una licencia predeterminada, mostrarla en el campo
                if (this.defaultLicense) {
                    licenseInput.value = this.defaultLicense;
                }
                
                // Configurar evento de clic para el botón de activación
                activateButton.onclick = () => {
                    const license = licenseInput.value.trim();
                    
                    if (!license) {
                        licenseMessage.textContent = "Por favor ingresa una licencia válida";
                        licenseMessage.style.display = "block";
                        return;
                    }
                    
                    if (this.validateLicense(license)) {
                        this.activateLicense(license);
                        dialog.style.display = "none";
                    } else {
                        licenseMessage.textContent = "Licencia inválida. Por favor verifica e intenta nuevamente.";
                        licenseMessage.style.display = "block";
                    }
                };
            },
            
            // Mostrar diálogo de generación de licencia
            showGeneratorDialog: function() {
                // Crear elementos del diálogo
                const dialog = document.createElement("div");
                dialog.className = "license-dialog";
                dialog.id = "generatorDialog";
                
                dialog.innerHTML = `
                    <div class="license-content">
                        <h2 class="license-title">Generador de Licencia</h2>
                        <p class="license-description">Genera una clave de licencia para tu cliente</p>
                        <div class="license-input-group">
                            <label for="customerName" class="license-label">Nombre del Cliente</label>
                            <input type="text" id="customerName" class="license-input" placeholder="Ingresa el nombre del cliente">
                        </div>
                        <div id="licenseResult" style="margin-top: 15px; display: none;">
                            <label for="generatedLicense" class="license-label">Licencia Generada</label>
                            <input type="text" id="generatedLicense" class="license-input" readonly>
                            <button id="copyButton" style="background-color: #333; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer; margin-top: 10px;">Copiar</button>
                        </div>
                        <div style="margin-top: 20px; display: flex; justify-content: space-between;">
                            <button id="closeButton" style="background-color: #333; color: white; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer;">Cerrar</button>
                            <button id="generateButton" style="background-color: #e50914; color: white; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer;">Generar Licencia</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(dialog);
                
                // Configurar eventos
                document.getElementById("generateButton").addEventListener("click", () => {
                    const customerName = document.getElementById("customerName").value.trim();
                    if (!customerName) {
                        this.showToast("Por favor ingresa el nombre del cliente", true);
                        return;
                    }
                    
                    const license = this.generateLicense(customerName);
                    document.getElementById("generatedLicense").value = license;
                    document.getElementById("licenseResult").style.display = "block";
                });
                
                document.getElementById("copyButton").addEventListener("click", () => {
                    const licenseInput = document.getElementById("generatedLicense");
                    licenseInput.select();
                    document.execCommand("copy");
                    this.showToast("Licencia copiada al portapapeles");
                });
                
                document.getElementById("closeButton").addEventListener("click", () => {
                    document.body.removeChild(dialog);
                });
            },
            
            // Activar una licencia
            activateLicense: function(licenseKey) {
                const titleElement = document.querySelector("h1");
                if (!titleElement) {
                    this.showToast("No se pudo encontrar el elemento de título", true);
                    return;
                }
                
                const currentH1Text = titleElement.textContent.trim();
                
                console.log("Activando licencia. Clave:", licenseKey, "H1 actual:", currentH1Text);
                
                // Verificar que el H1 coincida con el esperado
                if (currentH1Text !== this.expectedH1Text) {
                    console.log("El H1 no coincide con el esperado, no se puede activar la licencia");
                    this.showToast("Licencia incorrecta. No se puede activar el código.", true);
                    return;
                }
                
                // Verificar que la API key coincida con la esperada
                const currentApiKey = this.getCurrentApiKey();
                if (currentApiKey && currentApiKey !== this.expectedApiKey) {
                    console.log("La API key no coincide con la esperada, no se puede activar la licencia");
                    this.showToast("La licencia ya esta en uso. No se puede activar la licencia.", true);
                    return;
                }
                
                const isLicenseValid = this.validateLicense(licenseKey);
                
                if (isLicenseValid) {
                    console.log("Licencia válida, activando...");
                    this.isActivated = true;
                    this.licenseKey = licenseKey;
                    
                    // Guardar en localStorage
                    localStorage.setItem("streamfusion_license", licenseKey);
                    localStorage.setItem("streamfusion_activated", "true");
                    
                    // Iniciar monitoreo del título y API key
                    this.startTitleMonitoring();
                    this.startApiKeyMonitoring();
                    
                    this.showToast("Licencia activada correctamente");
                    
                    // Mostrar indicador de licencia
                    this.showLicenseStatus(true);
                    
                    // Inicializar la aplicación
                    initPage();
                } else {
                    console.log("Licencia inválida");
                    this.showToast("La clave de licencia es inválida", true);
                }
            },
            
            // Mostrar estado de licencia
            showLicenseStatus: function(isValid) {
                // Eliminar indicador existente si lo hay
                const existingStatus = document.getElementById("licenseStatus");
                if (existingStatus) {
                    document.body.removeChild(existingStatus);
                }
                
                // Crear nuevo indicador
                const status = document.createElement("div");
                status.id = "licenseStatus";
                status.className = isValid ? "license-status license-valid" : "license-status license-invalid";
                status.textContent = isValid ? "Licenciado" : "Sin Licencia";
                
                document.body.appendChild(status);
            },
            
            // Mostrar mensaje toast
            showToast: function(message, isError = false) {
                console.log("Toast:", message, isError ? "(Error)" : "");
                
                // Eliminar toast existente si lo hay
                const existingToast = document.getElementById("licenseToast");
                if (existingToast) {
                    document.body.removeChild(existingToast);
                }
                
                // Crear nuevo toast
                const toast = document.createElement("div");
                toast.id = "licenseToast";
                toast.className = `license-toast ${isError ? 'license-toast-error' : 'license-toast-success'}`;
                toast.textContent = message;
                toast.style.opacity = "0";
                
                document.body.appendChild(toast);
                
                // Mostrar y ocultar con animación
                setTimeout(() => {
                    toast.style.opacity = "1";
                    
                    setTimeout(() => {
                        toast.style.opacity = "0";
                        
                        setTimeout(() => {
                            if (document.body.contains(toast)) {
                                document.body.removeChild(toast);
                            }
                        }, 300);
                    }, 3000);
                }, 10);
            },
            
            // Configurar atajo de teclado para generación de licencia
            setupKeyboardShortcut: function() {
                let keyBuffer = "";
                
                window.addEventListener("keydown", (e) => {
                    if (e.target instanceof HTMLInputElement) return;
                    
                    // Rastrear las últimas 10 teclas presionadas
                    keyBuffer = (keyBuffer + e.key).slice(-10);
                    
                    // Comprobar si se escribió "genlicense"
                    if (keyBuffer === "genlicense") {
                        console.log("Atajo de teclado detectado: genlicense");
                        this.showGeneratorDialog();
                        keyBuffer = "";
                    }
                });
            }
        };

        const apiKey = '32e5e53999e380a0291d66fb304153fe';
        let currentVideoUrl = '';
        let retryCount = 0;
        const MAX_RETRIES = 3;
        let loadedResources = {
            movieData: false,
            relatedMovies: false,
            video: false
        };

        function checkAllResourcesLoaded() {
            if (loadedResources.movieData && loadedResources.relatedMovies && loadedResources.video) {
                const pageLoader = document.getElementById('pageLoader');
                if (pageLoader) {
                    pageLoader.classList.add('hidden');
                    setTimeout(() => {
                        pageLoader.style.display = 'none';
                    }, 500);
                }
            }
        }

        function handleImageError(img, fallbackUrl) {
            img.onerror = null;
            if (fallbackUrl) {
                img.src = fallbackUrl;
            } else {
                const svgFallback = `data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzJDMkMyQyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNkZWRlZGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkltYWdlbiBubyBkaXNwb25pYmxlPC90ZXh0Pjwvc3ZnPg==`;
                img.src = svgFallback;
            }
            console.log('Imagen reemplazada con fallback');
        }

        async function getConfiguration() {
            try {
                const response = await fetch(`https://api.themoviedb.org/3/configuration?api_key=${apiKey}`);
                if (!response.ok) throw new Error(`Error de configuración: ${response.status}`);
                const data = await response.json();
                return data.images.base_url;
            } catch (error) {
                console.error('Error al obtener configuración:', error);
                return 'https://image.tmdb.org/t/p/';
            }
        }

        async function fetchMovieData() {
            const movieId = 519182;

            try {
                const [baseUrl, movieData] = await Promise.all([
                    getConfiguration(),
                    fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${apiKey}&language=es-ES&append_to_response=credits`).then(res => {
                        if (!res.ok) throw new Error(`Error al obtener datos de película: ${res.status}`);
                        return res.json();
                    })
                ]);

                const posterPath = movieData.poster_path;
                const posterUrl = `${baseUrl}w500${posterPath}`;
                
                document.getElementById('movieTitle').innerText = movieData.title || 'Título no disponible';
                document.getElementById('movieReleaseDate').innerText = `Año: ${movieData.release_date ? new Date(movieData.release_date).getFullYear() : 'No disponible'}`;
                document.getElementById('movieGenres').innerText = `Categorías: ${movieData.genres && movieData.genres.length > 0 ? movieData.genres.map(genre => genre.name).join(', ') : 'No disponible'}`;
                
                const director = movieData.credits && movieData.credits.crew ? 
                    movieData.credits.crew.find(crewMember => crewMember.job === 'Director')?.name || 'No disponible' : 
                    'No disponible';
                document.getElementById('movieDirector').innerText = `Director: ${director}`;
                
                const actors = movieData.credits && movieData.credits.cast && movieData.credits.cast.length > 0 ? 
                    movieData.credits.cast.slice(0, 5).map(actor => actor.name).join(', ') : 
                    'No disponible';
                document.getElementById('movieActors').innerText = `Actores principales: ${actors}`;
                
                const posterImg = document.getElementById('moviePoster');
                posterImg.onload = function() {
                    adjustDetailsHeight();
                };
                posterImg.onerror = function() {
                    handleImageError(this);
                };
                posterImg.src = posterUrl;
                
                document.getElementById('movieOverview').innerText = movieData.overview || 'Descripción no disponible';
                
                loadedResources.movieData = true;
                checkAllResourcesLoaded();
                
                adjustDetailsHeight();
            } catch (error) {
                console.error('Error al cargar datos de la película:', error);
                
                document.getElementById('movieTitle').innerText = 'Error al cargar datos';
                document.getElementById('movieOverview').innerText = 'No se pudieron cargar los datos de la película. Por favor, intente recargar la página.';
                
                loadedResources.movieData = true;
                checkAllResourcesLoaded();
            }
        }

        function adjustDetailsHeight() {
            const poster = document.getElementById('moviePoster');
            const details = document.querySelector('.movie-details');

            if (poster && details && poster.complete) {
                details.style.height = `${poster.clientHeight}px`;
            }
        }
       
        function fetchRelatedMovies() {
            const moviesIDs = [822119, 1241982, 993710, 851644, 500664, 530254, 615173, 823219, 1357633, 12477, 402431, 558449, 539972, 939243, 1184918, 912649, 157350, 262500, 262504, 9316, 43209, 11238, 297761, 436969, 508442, 530915, 49046, 497582, 829280, 700391, 315162, 632856, 338958, 605886, 620705, 455476, 816904, 748167, 456740, 11253, 354912, 929590, 365177, 588228, 61979, 818647, 646097, 961323, 413518, 532639, 555604, 10895, 862, 863, 10193, 301528, 213121, 256835, 594530, 15167, 168903, 13002, 1729, 957452, 917496, 346698, 250546, 396422, 521029,37135, 258489, 230222, 13683, 15657, 22794, 109451, 8960, 832502, 254, 177572, 8587, 9732, 420818, 11430, 9502, 49444, 140300, 10601, 10693, 420808, 16690, 381719, 522478, 11970, 184315, 505026, 512195, 329996, 11224, 14128, 16119, 150689, 13179, 297270, 44683, 175112, 25475, 75258, 614409, 565426, 466282, 15213, 545611, 118, 458897, 9471, 4327, 240832, 1979, 166424, 22832, 133805, 7342, 1075794, 71676, 1250, 447277, 298618, 579741, 75656, 291805, 930600, 438148, 20352, 93456, 324852, 397567, 518068, 378236, 10681, 12244, 454626, 675353, 708336, 832227, 336560, 9035, 14564, 607836, 473165, 44896, 1368, 1369, 1370, 7555, 522938, 9757, 970347, 1032823, 748783, 8920, 9513, 371608, 10665, 877269, 27578, 138103, 299054, 953, 10527, 80321, 270946, 624860, 605, 604, 603, 1029955, 454286, 249660, 347126, 793285, 1079091, 459003, 1096197, 118340, 283995, 447365, 597, 1226578, 333339, 945961, 9334, 13486, 297291, 287947, 594767, 62177, 1094138, 960704, 417261, 238215, 6479, 715931, 495764, 38757, 295693, 459151, 10555, 760741, 58595, 290595, 585511, 447332, 8844, 353486, 512200, 568124, 497698, 436270, 80278, 363676, 49047, 1151534, 1593, 18360, 181533, 72105, 214756, 271110, 1771, 100402, 831815, 9023, 10501, 13186, 23823, 71672, 125509, 259072, 9902, 862855, 399579, 1059064, 346910, 766507, 4247, 4248, 4256, 4257, 4258, 580489, 335983, 791373, 297802, 284053, 488623, 974262, 961268, 588648, 1129598, 46019, 1308757, 26466, 916224, 508439, 718821, 16353, 9799, 584, 168259, 9615, 13804, 51497, 49529, 9806, 664413, 829560, 829557, 533535, 11237, 205584, 653346, 931405, 150540, 408355, 505642, 640146, 630004, 76600, 653349, 693134, 76341, 98, 277834, 400160, 82992, 337339, 385128, 384018, 385687, 593910, 572802, 565770, 284054, 299536, 786892, 324857, 274854, 550205, 260513, 399566, 299534, 1022789, 359410, 629176, 634649, 848326, 315635,429617, 557, 527774, 12153, 1930, 559, 558,  573435, 519182, 102899, 363088, 639720, 466420, 1029528, 1019411, 1010581, 823464, 1011985, 269149, 955916, 985939, 1001311, 454983, 583083, 727745, 603692, 324552, 245891, 704673, 99861, 566525, 24428,  1026999, 987686, 955555, 626412, 940551, 109445, 330457, 508883,447200, 967847,  614933, 280180, 987686, 1134433, 1025463, 829402, 940721, 1023922, 984324, 934632, 634492,
  762441, 809, 1016346, 1291559, 901362, 739547, 872585,1094844, 838209, 1243895, 76163, 866398, 1239251, 969492, 438631, 1022796, 641934, 458156, 502356, 974635, 569094, 763215, 293660, 976573, 335977, 746036, 682201, 1115623, 575264, 508947, 678512, 897087, 784651, 1231574, 916224, 445030, 680041, 372058, 667520, 79707, 876792];

            const API_KEY = '32e5e53999e380a0291d66fb304153fe';
            const BASE_URL = 'https://api.themoviedb.org/3';
            const IMG_URL = 'https://image.tmdb.org/t/p/';
            const LANGUAGE = 'es-MX';

            // Seleccionar aleatoriamente 18 películas
            const shuffled = moviesIDs.sort(() => 0.5 - Math.random());
            const selectedMovies = shuffled.slice(0, 18);

            // Crear todas las promesas de fetch
            const fetchPromises = selectedMovies.map(id =>
                fetch(`${BASE_URL}/movie/${id}?api_key=${API_KEY}&language=${LANGUAGE}`)
                    .then(response => response.json())
            );

            // Ejecutar todas las promesas en paralelo
            Promise.all(fetchPromises)
                .then(movies => {
                    document.getElementById('relatedLoader').style.display = 'none';
                    document.getElementById('relatedLoader2').style.display = 'none';

                    movies.forEach((item, index) => {
                        const containerClass = index < 6 ? '.related-movies .content' : '.related-movies-2 .content-2';
                        const container = document.querySelector(containerClass);

                        if (!container) return;

                        const div = document.createElement('div');
                        div.classList.add('item');
          // Crear la imagen con un placeholder mientras carga
          const posterPath = item.poster_path
          const posterUrl = posterPath ? `${IMG_URL}w500${posterPath}` : null
          
                        div.innerHTML = `
                            <a href="go:${item.id}" target="_blank" rel="noreferrer">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzJDMkMyQyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNkZWRlZGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkNhcmdhbmRvLi4uPC90ZXh0Pjwvc3ZnPg==" 
                                 data-src="${posterUrl}" 
                                 alt="${item.name}" 
                                 loading="lazy">
                                <div class="item-rating">⭐ ${item.vote_average ? item.vote_average.toFixed(1) : 'N/A'}</div>
                                <div class="item-title">${item.title}</div>                        
                            </a>
                        `;
                        container.appendChild(div);
                    });

                    loadedResources.relatedMovies = true;
                    checkAllResourcesLoaded();
                })
                .catch(error => {
                    console.error('Error fetching related movies:', error);
                    loadedResources.relatedMovies = true;
                    checkAllResourcesLoaded();
                });
        }

        function loadVideo(videoUrl) {
            return new Promise((resolve, reject) => {
                currentVideoUrl = videoUrl;
                const iframe = document.getElementById("videoPlayer");
                
                iframe.onload = function() {
                    console.log('Video cargado correctamente');
                    loadedResources.video = true;
                    checkAllResourcesLoaded();
                    resolve();
                };
                
                iframe.onerror = function() {
                    console.error('Error al cargar el video');
                    if (retryCount < MAX_RETRIES) {
                        retryCount++;
                        console.log(`Reintentando cargar video (${retryCount}/${MAX_RETRIES})...`);
                        setTimeout(() => {
                            iframe.src = 'about:blank';
                            setTimeout(() => {
                                iframe.src = videoUrl;
                            }, 500);
                        }, 1000);
                    } else {
                        loadedResources.video = true;
                        checkAllResourcesLoaded();
                        reject(new Error('No se pudo cargar el video después de varios intentos'));
                    }
                };
                
                iframe.src = videoUrl;
                
                setTimeout(() => {
                    if (!loadedResources.video) {
                        loadedResources.video = true;
                        checkAllResourcesLoaded();
                        console.log('Tiempo de carga del video excedido, continuando con la interfaz');
                        resolve();
                    }
                }, 10000);
            });
        }

        function reloadCurrentVideo() {
            const reloadButton = document.getElementById("reloadButton");
            reloadButton.classList.add('loading');
            
            const iframe = document.getElementById("videoPlayer");
            iframe.src = 'about:blank';
            
            setTimeout(() => {
                iframe.src = currentVideoUrl;
                setTimeout(() => {
                    reloadButton.classList.remove('loading');
                }, 1000);
            }, 1000);
        }

        function loadLazyImages() {
            const lazyImages = document.querySelectorAll('img[data-src]');
            lazyImages.forEach(img => {
                if (img.dataset.src) {
                    const actualImg = new Image();
                    actualImg.onload = function() {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                    };
                    actualImg.onerror = function() {
                        handleImageError(img);
                        img.removeAttribute('data-src');
                    };
                    actualImg.src = img.dataset.src;
                }
            });
        }

        async function initPage() {
            try {
                const videoPromise = loadVideo(document.getElementById('videoPlayer').getAttribute('data-src'));
                
                fetchMovieData();
                fetchRelatedMovies();
                
                await Promise.race([
                    videoPromise,
                    new Promise(resolve => setTimeout(resolve, 10000))
                ]);
                
                if ('IntersectionObserver' in window) {
                    const imageObserver = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                if (img.dataset.src) {
                                    img.src = img.dataset.src;
                                    img.removeAttribute('data-src');
                                    imageObserver.unobserve(img);
                                }
                            }
                        });
                    });
                    
                    document.querySelectorAll('img[data-src]').forEach(img => {
                        imageObserver.observe(img);
                    });
                } else {
                    loadLazyImages();
                }
            } catch (error) {
                console.error('Error durante la inicialización de la página:', error);
                loadedResources.video = true;
                checkAllResourcesLoaded();
            }
        } 

        window.addEventListener('load', () => {
            document.getElementById("reloadButton").addEventListener("click", (e) => {
                e.preventDefault();
                reloadCurrentVideo();
            });
            
            // Inicializar el sistema de licencia cuando se carga la página
            licenseSystem.init();
        });

        window.addEventListener('resize', adjustDetailsHeight);
        
        window.addEventListener('error', function(e) {
            console.error('Error global capturado:', e.message);
            Object.keys(loadedResources).forEach(key => {
                if (!loadedResources[key]) {
                    loadedResources[key] = true;
                }
            });
            checkAllResourcesLoaded();
        });
    </script>
  <script>
    document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
	});
  </script>
</head>
<body>
    <div id="pageLoader" class="page-loader">
        <div class="loading-spinner"></div>
    </div>

    <!-- Sistema de licencia -->
    <div id="license-dialog" class="license-dialog" style="display: none;">
        <div class="license-content">
            <h2 class="license-title">Activar StreamFusion</h2>
            <p class="license-description">Ingrese su clave de licencia para continuar</p>
            <div class="license-input-group">
                <label for="licenseKey" class="license-label">Clave de Licencia</label>
                <input type="text" id="licenseKey" class="license-input" value="" placeholder="SF-XXXX-XXXX">
            </div>
            <div class="license-button-group">
                <button id="activateButton" class="license-button">Activar</button>
            </div>
            <p id="license-message" class="license-message"></p>
        </div>
    </div>

    <header>
        <div class="logo">
            <a href="go:home" class="back-link"><i class="fas fa-chevron-left"></i></a>
        </div>
        <div class="header-content">      	
            <h1 class="streamfusion">StreamFusion</h1>
        </div>
        <div class="logo">
            <a href="go:sr" class="report"><i class="fas fa-exclamation"></i></a>
        </div>
    </header>
    <div class="container">
        <div class="player">
            <div class="videoPlayer">
                <iframe id="videoPlayer" width="100%" height="100%" src="about:blank" data-src="https://www.youtube.com/embed/I0_qFoptZ4Y?si=keURDeycztyTtRcr" frameborder="0" allowfullscreen></iframe>
                <button id="reloadButton" class="reload-button" title="Recargar video">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div class="text-h3-0">
                <h3>También te podría gustar!</h3>
            </div>
            <div class="related-movies-2">
                <div class="content-2" id="relatedContent2">
                    <div class="loading-spinner" id="relatedLoader2" style="margin: 20px auto;"></div>
                </div>
            </div>
        </div>
        <div class="sidebar">
            <div class="movie-info">
                <div class="movie-poster">
                    <img id="moviePoster" alt="Poster de la película" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzJDMkMyQyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNkZWRlZGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkNhcmdhbmRvLi4uPC90ZXh0Pjwvc3ZnPg==">
                </div>
                <div class="movie-details">
                    <h2 id="movieTitle">Cargando...</h2>
                    <p id="movieReleaseDate">Año: ...</p>
                    <p id="movieGenres">Categorías: ...</p>
                    <p id="movieDirector">Director: ...</p>
                    <p id="movieActors">Actores principales: ...</p>
                </div>
            </div>
            <div class="movie-overview">
                <p id="movieOverview">Cargando descripción...</p>
            </div>

            <div class="text-h3-1">
                <h3>También te podría gustar!</h3>
            </div>
            <div class="related-movies">
                <div class="content" id="relatedContent">
                    <div class="loading-spinner" id="relatedLoader" style="margin: 20px auto;"></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
